import os
import getCve
from dotenv import load_dotenv
import notification
import datetime
from datetime import timedelta


def createMessage(data):
    result = ''
    for instance in data:
        if (data.get(instance) != ""):
            result = result + data.get(instance)
    return result


def main():

    load_dotenv()
    url = os.getenv('NVD_URL')
    end = datetime.datetime.now(
        datetime.timezone.utc).strftime("%Y-%m-%dT%H:%M:%S.%f")

    start = (datetime.datetime.now(
        datetime.timezone.utc) - timedelta(1)).strftime("%Y-%m-%dT%H:%M:%S.%f")

    cve = getCve.cve(url, dict(
        pubStartDate=str(start), pubEndDate=str(end)))
    data = cve.get()
    result = createMessage(data)
    slack_instance = notification.slack(result)
    slack_instance.sendMessage()


main()
